/*! country-data-interface 14-09-2014 */
angular.module("country-interface",["ngRoute","ci.common","ci.countries","ci.maps"]).config(["$routeProvider",function(a){a.when("/about",{templateUrl:"template/about.html",title:"About"}).when("/country/:cca3",{controller:"CountryDetailController",templateUrl:"template/countryDetail.html"}).when("/search/:search",{controller:"CountryIndexController",templateUrl:"template/countryIndex.html",title:"Search"}).otherwise({controller:"CountryIndexController",templateUrl:"template/countryIndex.html"})}]).run(["$rootScope","$location","AnalyticsService",function(a,b,c){var d="Countries of the World";a.page={setTitle:function(a){this.title=a+" | "+d}},a.$on("$routeChangeSuccess",function(e,f){var g=d;angular.isDefined(f.$$route)&&angular.isDefined(f.$$route.title)&&(g=f.$$route.title),a.page.setTitle(g),c.track(b.path())})}]),angular.module("ci.common",["ci.common.services"]),angular.module("ci.common.services",[]),angular.module("ci.common.services").factory("AnalyticsService",["$window",function(a){return{track:function(b){""===b&&(b="/"),a.ga(function(){a.ga("send","pageview",{page:b})})}}}]),angular.module("ci.countries",["ci.countries.controllers","ci.countries.directives","ci.countries.filters","ci.countries.services"]),angular.module("ci.countries.controllers",[]),angular.module("ci.countries.directives",[]),angular.module("ci.countries.filters",[]),angular.module("ci.countries.services",[]),angular.module("ci.countries.controllers").controller("CountryDetailController",["$scope","$routeParams","CountryService",function(a,b,c){a.country={},a.geoData=null,a.shouldShowTranslations=!1,c.find(b.cca3).then(function(b){a.country=b,a.country.osmUrl=d(),a.country.hasLanguages=e(),a.page.setTitle(a.country.name.common)}),c.findGeoData(b.cca3).then(function(b){a.geoData=b}),a.toggleTranslations=function(){a.shouldShowTranslations=!a.shouldShowTranslations};var d=function(){var b=a.country.latlng[0],c=a.country.latlng[1];return"http://www.openstreetmap.org/#map=5/"+b+"/"+c},e=function(){return!(angular.equals(a.country.languages,{})||angular.equals(a.country.languages,[]))}}]),angular.module("ci.countries.controllers").controller("CountryIndexController",["$scope","$location","$routeParams","CountryService",function(a,b,c,d){a.countries=[],a.searchTerm=c.search?c.search:"",d.query().then(function(b){a.countries=b}),a.showDetail=function(a){b.path("/country/"+a.cca3)}}]),angular.module("ci.countries.directives").directive("countrySummary",[function(){return{link:function(){},restrict:"E",scope:{country:"=",select:"&onSelect"},templateUrl:"/template/countrySummaryDirective.html"}}]),angular.module("ci.countries.filters").filter("ifEmpty",[function(){return function(a,b){return"undefined"==typeof a?b:a.length?a:b}}]),angular.module("ci.countries.filters").filter("search",function(){return function(a,b){var c=[];b=b.toUpperCase();var d=function(a){return a.toUpperCase().substring(0,b.length)===b},e=function(a){var b=!1;return angular.forEach(a,function(a){d(a)&&(b=!0)}),b};return angular.forEach(a,function(a){d(a.name.common)?c.push(a):d(a.name.native.common)?c.push(a):b.length<=2&&d(a.cca2)?c.push(a):b.length<=3&&d(a.cca3)?c.push(a):b.length<=3&&e(a.currency)?c.push(a):e(a.translations)&&c.push(a)}),c}}),angular.module("ci.countries.services").factory("CountryService",["$http","$q",function(a,b){return{query:function(){var c=b.defer();return a.get("/data/countries.json",{cache:!0}).success(function(a){c.resolve(a)}).error(function(){c.resolve([])}),c.promise},find:function(a){var c=b.defer();return a=a.toUpperCase(),this.query().then(function(b){angular.forEach(b,function(b){a===b.cca3&&c.resolve(b)}),c.resolve({})}),c.promise},findGeoData:function(c){var d=b.defer(),e=function(a){return"undefined"==typeof a.features?!1:a.features.length?"undefined"==typeof a.features[0].geometry?!1:!0:!1};return c=c.toLowerCase(),a.get("/data/geo/"+c+".geo.json",{cache:!0}).success(function(a){d.resolve(e(a)?a:null)}).error(function(){d.resolve(null)}),d.promise}}}]),angular.module("ci.maps",["ci.maps.directives","ci.maps.services"]),angular.module("ci.maps.directives",[]),angular.module("ci.maps.services",[]),angular.module("ci.countries.directives").directive("mapView",["$timeout","LeafletService",function(a,b){var c=function(c,d,e){var f;return c&&d?(c.whenReady(function(){f=b.geoJson().addTo(c),f.addData(d),e&&a(function(){c.fitBounds(f.getBounds())},10)}),f):null};return{link:function(a){var d,e="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",f='Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';d=b.map("map-view").setView([a.center[0],a.center[1]],3),b.tileLayer(e,{attribution:f,maxZoom:18}).addTo(d),a.$watch("geoJson",function(a){c(d,a,!0)}),a.mapHeight=300},restrict:"E",scope:{center:"=",geoJson:"="},templateUrl:"/template/mapViewDirective.html"}}]),angular.module("ci.maps.services").factory("LeafletService",["$window",function(a){return a.L}]);